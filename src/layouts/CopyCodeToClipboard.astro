<style lang='scss' is:global>
	.code-wrapper {
		display: flex;
		justify-content: flex-end;
	}

	.copy-button {
		transition: background-color 0.2s, color 0.2s;
		cursor: pointer;
	}

	.success {
		background-color: var(--theme-text-accent);
		color: var(--theme-bg);
		animation: button-success 0.2s ease-in-out;
	}

	@keyframes button-success {
		0% {
			transform: scale(1);
		}
		20% {
			transform: scale(1.1);
		}
		100% {
			transform: scale(1);
		}
	}
</style>

<script is:inline>
	const codeSnippet = [...document.querySelectorAll('.astro-code')]

	const copyButton = () => {
		const button = document.createElement('button')
		button.classList.add('copy-button')
		button.innerHTML = 'Copy'
		return button
	}

	codeSnippet.forEach((block) => {
		const wrapper = document.createElement('div')
		const button = copyButton()
		wrapper.classList.add('code-wrapper')
		wrapper.appendChild(button)
		block.prepend(wrapper)
		button.addEventListener('click', () => {
			navigator.clipboard.writeText(block.innerText).then(
				() => {
					button.classList.add('success')
					button.innerText = 'Copied'
					setTimeout(() => {
						button.innerText = 'Copy'
						button.classList.remove('success')
					}, 1000)
				},
				() => {
					button.innerText = 'Error'

					setTimeout(() => {
						button.innerText = 'Copy'
					}, 1000)
				}
			)
		})
	})
</script>
